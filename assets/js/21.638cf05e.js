(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{1995:function(t,e,a){"use strict";a.r(e);var s=a(21),n=Object(s.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"managing-memory-and-finding-leaks"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#managing-memory-and-finding-leaks"}},[t._v("#")]),t._v(" Managing Memory and Finding Leaks")]),t._v(" "),s("h2",{attrs:{id:"objective"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#objective"}},[t._v("#")]),t._v(" Objective")]),t._v(" "),s("p",[t._v("In this section, you will learn how to monitor for and solve memory leaks in your apps. The processes for monitoring memory usage varies by platform. You'll learn separately how to perform this feat on iOS, Android and Windows.")]),t._v(" "),s("h2",{attrs:{id:"contents"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#contents"}},[t._v("#")]),t._v(" Contents")]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("⚠️ Warning")]),t._v(" "),s("p",[t._v("Let's start with a clarification: we're talking memory, "),s("em",[t._v("not")]),t._v(" storage in this section. Memory, sometimes called RAM, is the volatile location in which your app and its data are retained while they're being processed by the CPU. Storage is the long-term location where app data is retained while you're not using the app or device. In a desktop computer, the distinction is a bit easier: memory is done with chips; storage is done with the hard drive, floppy disk, or CD-ROM.")]),t._v(" "),s("p",[t._v("In a mobile device, both memory and storage are implemented as chips. Storage uses Flash memory chips, slow, but such chips don't lose their contents when power is removed. Memory uses RAM-style chips (DRAM, etc.), which are fast but volatile (contents lost when power removed).")])]),t._v(" "),s("p",[t._v("CPUs in smartphones and tablets are amazingly advanced. The JavaScript Core and V8 interpreters that Titanium uses are quite fast and well-optimized for mobile apps. Computation speed is rarely an issue with apps these days. Memory is typically the largest bottleneck, a factor you'll need to actively manage as your apps grow in complexity.")]),t._v(" "),s("p",[t._v("In this section, we'll see what factors go into determining how much memory your app uses. We'll see how Titanium frees memory, which will require a peek under the covers to see how JavaScript manages memory. And we'll look at issues that can cause memory leaks--memory allocations that grow over time to the point where your app could crash.")]),t._v(" "),s("p",[t._v("Memory limits vary by operating system and device and are not clearly documented by the vendors. Based on our sleuthing, here are the limits you must be concerned with:")]),t._v(" "),s("div",{staticClass:"custom-block danger"},[s("p",{staticClass:"custom-block-title"},[t._v("❗️ iOS notes")]),t._v(" "),s("p",[t._v('The numbers for iOS are rough estimates. Apple does not publish information about their app termination threshold, managed by processes called "watchdog" (responsible for monitoring) and "jetsam" (responsible for warnings/purging). App termination is controlled entirely at the discretion of these processes and their behavior may change at any time.')]),t._v(" "),s("p",[t._v("The upside of this is that if you see a crash or device log referencing jetsam, this certainly indicates a memory issue.")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("iPhone: Limited to 10% of system memory")])]),t._v(" "),s("li",[s("p",[t._v("iPad: Limited to between 30-50 MB; smaller is always better")])]),t._v(" "),s("li",[s("p",[t._v('Android: 24-32MB heap, optional "large heap" of 128MB ('),s("RouterLink",{attrs:{to:"/guide/Titanium_SDK/Titanium_SDK_Guide/Appendices/tiapp.xml_and_timodule.xml_Reference/#application-properties"}},[t._v("Application properties")]),t._v(" for how to enable this)")],1)])]),t._v(" "),s("p",[t._v("Compared to the memory space available to the desktop, these are severely restricted amounts. Furthermore, iOS, Android and Windows can force-reclaim memory or force-quit an app when the system needs more free memory. You'll want to limit your memory use and free allocations when you can. Let's see how JavaScript frees memory and then how you can release memory in your Titanium app.")]),t._v(" "),s("h3",{attrs:{id:"javascript-garbage-collection"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#javascript-garbage-collection"}},[t._v("#")]),t._v(" JavaScript garbage collection")]),t._v(" "),s("p",[t._v("In some languages, the programmer must explicitly allocate and de-allocate memory within their programs. This manual process can take quite a bit of work and is often the source of bugs. JavaScript instead uses an automatic technique called "),s("em",[t._v("garbage collection")]),t._v(". With garbage collection, the JavaScript interpreter determines when objects are no longer needed, then destroys them to free the memory they were using.")]),t._v(" "),s("p",[t._v('Most modern JavaScript interpreters use a "mark and sweep" method for determining when to garbage collect objects. Periodically, execution stops while the interpreter scans memory building a list of every object in memory. It marks those to which there is a reference (an active variable name, being a property of on object that\'s in use, and so forth) and those to which there are no active references. When it\'s done with this sweep, the interpreter sends a "destroy" message to all of the objects that have no active references. Those object tear themselves down and release their memory.')]),t._v(" "),s("p",[t._v("In this way, JavaScript automatically clears out objects that are not being used. Problems arise when you leave references to objects that you no longer need. You can remove references by setting variables and objects to "),s("code",[t._v("null")]),t._v(" when you no longer need them. This includes both variables and objects you create to represent your app's business logic, but also objects that represent Titanium components such as Views or Images.")]),t._v(" "),s("h3",{attrs:{id:"when-titanium-releases-memory"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#when-titanium-releases-memory"}},[t._v("#")]),t._v(" When Titanium releases memory")]),t._v(" "),s("p",[t._v("Titanium is a bridge between JavaScript and the native operating system. When you define a Titanium object, such as a Button or View, Titanium creates a matching proxy in the native operating system. Titanium will destroy that native proxy object, freeing the memory it used, when the corresponding JavaScript object is destroyed.")]),t._v(" "),s("ul",[s("li",[t._v("Calling "),s("em",[t._v("parent")]),t._v("."),s("code",[t._v("remove()")]),t._v(" then setting the JavaScript object to "),s("code",[t._v("null")]),t._v(" destroys both the proxy and JavaScript object. You won't be able to "),s("code",[t._v("add()")]),t._v(" it to the view hierarchy later without redefining it.")])]),t._v(" "),s("p",[t._v("To be clear, calling "),s("em",[t._v("parent")]),t._v("."),s("code",[t._v("remove()")]),t._v(" on its own does "),s("em",[t._v("not")]),t._v(" destroy either the JavaScript or proxy object. You must "),s("code",[t._v("null")]),t._v(" the JavaScript object to destroy its related proxy.")]),t._v(" "),s("p",[t._v("Destroying a parent object (setting it to "),s("code",[t._v("null")]),t._v(") will destroy any child objects as long as no other references to those child objects exist. Consider the following code snippet to get a feel for the specifics:")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" button "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Ti"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("UI")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createButton")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// parameters go here...")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" view "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Ti"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("UI")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createView")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// some parameters here...")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nview"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("button"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ... later")]),t._v("\nwin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("remove")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("view"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// view & button still exist")]),t._v("\nview "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// deletes the view and its proxy, but not the button!")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// compare that to:")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" view "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Ti"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("UI")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createView")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// some parameters here...")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nview"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Ti"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("UI")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createButton")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// parameters go here...")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ... later")]),t._v("\nwin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("remove")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("view"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nview "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// deletes the view, button, and their proxies")]),t._v("\n")])])]),s("p",[t._v('Make sure that you actively manage the Titanium objects you create, such as Windows, Views, and Buttons. Remove them from the view hierarchy and destroy them when you no longer need them. You might do this when a user closes a "dialog box" (view) or changes tabs in your app.')]),t._v(" "),s("h3",{attrs:{id:"memory-leaks"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#memory-leaks"}},[t._v("#")]),t._v(" Memory leaks")]),t._v(" "),s("p",[t._v("Memory leaks occur when your app allocates memory but doesn't release it. Leaks occur when unintended or overlooked references to objects remain in scope. When this happens, JavaScript can't garbage collect the objects and Titanium can't destroy the native proxies. Because the causes of leaks vary so widely, at best we'll be able to give you some strategies to attempt in order to solve the problems. There are no \"cookie cutter\" solutions for stopping memory leaks.")]),t._v(" "),s("h4",{attrs:{id:"example-sources-of-memory-leaks"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#example-sources-of-memory-leaks"}},[t._v("#")]),t._v(" Example sources of memory leaks")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("Hiding a View removes it from the display, but retains the object in memory. To conserve memory, call "),s("em",[t._v("parent")]),t._v("."),s("code",[t._v("remove()")]),t._v(" and/or set the object equal to "),s("code",[t._v("null")]),t._v(" when you no longer need it, as described above.")])]),t._v(" "),s("li",[s("p",[t._v("Declaration of an object within a "),s("a",{attrs:{href:"http://jibbering.com/faq/notes/closures/",target:"_blank",rel:"noopener noreferrer"}},[t._v("closure"),s("OutboundLink")],1),t._v(" can preserve references to an object that might no longer be needed. Moving object declarations out of the closure (pass a reference in as a method argument) is one way to resolve this problem.")])]),t._v(" "),s("li",[s("p",[t._v('Declaring objects within a "global" event listener means those objects will remain in scope as long as the event listener exists. Global event listeners include those set on Ti.App, Ti.Geolocation, Ti.Gesture, and so forth.')])])]),t._v(" "),s("p",[s("strong",[t._v("Creating and fixing a memory leak in a global event listener")])]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("doSomething")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("_event")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" foo "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" bar"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// adding this event listener causes a memory leak")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// as references remain valid as long as the app is running")]),t._v("\nTi"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("App"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bad:idea'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" doSomething"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// you can plug this leak by removing the event listener, for example when the window is closed")]),t._v("\nthisWindow"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'close'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// to remove an event listener, you must use the exact same function signature")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// as when the listener was added")]),t._v("\n  Ti"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("App"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeEventListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bad:idea'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" doSomething"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"monitoring-allocations-on-ios"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#monitoring-allocations-on-ios"}},[t._v("#")]),t._v(" Monitoring allocations on iOS")]),t._v(" "),s("p",[t._v("To run a Titanium app from the Xcode build, you have two choices:")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("Change your Xcode Workspace settings in "),s("strong",[t._v("Xcode")]),t._v(" > "),s("strong",[t._v("Preferences")]),t._v(" > "),s("strong",[t._v("Locations")]),t._v(" > "),s("strong",[t._v("Derived Data")]),t._v(" > "),s("strong",[t._v("Advanced")]),t._v(" > Select "),s("strong",[t._v("Custom")]),t._v(" in the Build Location options and select "),s("strong",[t._v("Relative to Workspace")]),t._v(" from the drop down.")]),t._v(" "),s("p",[s("img",{attrs:{src:a(750),alt:"Xcode9Workspace"}})])]),t._v(" "),s("li",[s("p",[t._v("Copy the contents of your "),s("code",[t._v("Resources/")]),t._v(' (same for Alloy by including the generated Alloy code) directory to the "Resources" group in Xcode')])])]),t._v(" "),s("p",[t._v("Lets continue! Apple's Instruments application is a handy tool for monitoring and discovering memory leaks. Here's how you can use it for this purpose:")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("Open your app in the iOS simulator.")])]),t._v(" "),s("li",[s("p",[t._v("Open Instruments:")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("Start Xcode and from the menu, select "),s("strong",[t._v("Xcode")]),t._v(" > "),s("strong",[t._v("Open Developer Tools")]),t._v(" > "),s("strong",[t._v("Instruments")]),t._v(".")])]),t._v(" "),s("li",[s("p",[t._v("In the Choose a Template window, click "),s("strong",[t._v("Allocations")]),t._v(" and click "),s("strong",[t._v("Choose")]),t._v(".")])])])]),t._v(" "),s("li",[s("p",[t._v("Attach your application to Instruments.")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("Click "),s("strong",[t._v("Choose Target")]),t._v(", click "),s("strong",[t._v("More...")]),t._v(" under "),s("strong",[t._v("System")]),t._v(", then scroll down and click your app's name.")])]),t._v(" "),s("li",[s("p",[t._v("Click "),s("strong",[t._v("Record")]),t._v(". Wait a moment till data begins recording.")])])])]),t._v(" "),s("li",[s("p",[t._v('In the Instrument Detail filter box, enter a filter string, such as "'),s("code",[t._v("TiUI")]),t._v('" to show only relevant allocation information.')])]),t._v(" "),s("li",[s("p",[t._v("Click and use your app while watching these values in Instruments:")])])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[s("strong",[t._v("Column")])]),t._v(" "),s("th",[s("strong",[t._v("Shows")])]),t._v(" "),s("th",[s("strong",[t._v("Notes")])])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("strong",[t._v("Persistent Bytes  "),s("br"),t._v("(or Live Bytes)")])]),t._v(" "),s("td",[t._v("Memory currently being used by active instances of the object in memory")]),t._v(" "),s("td",[t._v("You may have a leak if this number continues to grow as you use your app.")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("#Persistent  "),s("br"),t._v("(or #Living)")])]),t._v(" "),s("td",[t._v("Number of active instances of the object in memory")]),t._v(" "),s("td",[t._v("You may have a leak if this number continues to grow as you use your app.")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("#Transient  "),s("br"),t._v("(or #Transitory)")])]),t._v(" "),s("td",[t._v("Number of ready-to-be-garbage-collected instances of the object")]),t._v(" "),s("td",[t._v("Transitory objects might or might not be in memory. It doesn't matter if this value grows over time. JavaScriptCore will garbage collect periodically; any transitory objects will be destroyed when it does so.")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("Total Bytes  "),s("br"),t._v("(or Overall Bytes)")])]),t._v(" "),s("td",[t._v("Bytes used by Living and Transitory objects")]),t._v(" "),s("td",[t._v("This number will grow until garbage collection runs.")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("#Total  "),s("br"),t._v("(or #Overall)")])]),t._v(" "),s("td",[t._v("Sum of Living and Transitory")]),t._v(" "),s("td",[t._v("This number will grow over time.")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("Transient / Total Bytes  "),s("br"),t._v("[or # Allocations (Net / Overall)]")])]),t._v(" "),s("td",[t._v("A histogram of the current and total accounts.")]),t._v(" "),s("td")])])]),t._v(" "),s("p",[t._v("If you make a change to your app, the most reliable way to gather new statistics in Instruments is to close it and start over.")]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("⚠️ Tracking memory more accurately")]),t._v(" "),s("p",[t._v("On iOS, the runtime and other systems may frequently allocate (or deallocate) objects which can't be managed directly through your javascript code. In general, when checking your app for memory leaks, you should be filtering for objects with the \""),s("code",[t._v("Ti")]),t._v('" prefix.')]),t._v(" "),s("p",[t._v("Also note that by attaching the profiler after the app has started, you do not get any information on already-created objects until they are touched by the memory management system. To get more accurate information, you may need to open the Xcode project generated in your project's "),s("code",[t._v("build/iphone")]),t._v(" folder, and choose "),s("strong",[t._v("Product")]),t._v(" > "),s("strong",[t._v("Profile")]),t._v(", then configure the resulting Instruments launch as described here.")])]),t._v(" "),s("p",[s("img",{attrs:{src:a(751),alt:"instruments"}})]),t._v(" "),s("h3",{attrs:{id:"monitoring-allocations-on-android"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#monitoring-allocations-on-android"}},[t._v("#")]),t._v(" Monitoring allocations on Android")]),t._v(" "),s("p",[t._v("Android's "),s("a",{attrs:{href:"https://developer.android.com/studio/profile/monitor.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("DDMS Tool"),s("OutboundLink")],1),t._v(" can show you memory leaks – both memory allocations that are not freed and objects that aren't garbage collected. Following the procedure shown here, you can watch as memory use and object allocations grow. You'll need to pair that information, with knowledge of your app to determine where within your app the cause might be.")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("Build your app for the Android emulator at least once.")])]),t._v(" "),s("li",[s("p",[t._v("In your text editor, open "),s("code",[t._v("<project>/build/android/AndroidManifest.xml")]),t._v(".")])]),t._v(" "),s("li",[s("p",[t._v("Copy the "),s("code",[t._v("<application>")]),t._v(" node, a sample of which is shown here (your app name would vary, of course):")]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("application")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("android:")]),t._v("icon")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("@drawable/appicon"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("android:")]),t._v("label")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("AppLeak"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("android:")]),t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("AppleakApplication"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("android:")]),t._v("debuggable")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("false"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("Paste that into your app's tiapp.xml file, modifying the "),s("code",[t._v("<android>")]),t._v(" node as shown:")]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("android")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("xmlns:")]),t._v("android")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://schemas.android.com/apk/res/android"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("manifest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("application")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("android:")]),t._v("icon")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("@drawable/appicon"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("android:")]),t._v("label")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("AppLeak"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("android:")]),t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("AppleakApplication"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("android:")]),t._v("debuggable")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("true"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("application")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("manifest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("android")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("p",[t._v("Notice that we've set debuggable to true and added and completed a couple of the nodes.")])]),t._v(" "),s("li",[s("p",[t._v("Save and build your app for the Android emulator again.")])]),t._v(" "),s("li",[s("p",[t._v("Open DDMS.")])]),t._v(" "),s("li",[s("p",[t._v("As shown in the screenshot below, click to select your app in the list of processes. Then, click the Show Heap Updates button (labeled #2 in the graphic).")])]),t._v(" "),s("li",[s("p",[t._v("On the VM Heap tab, click Cause GC to force garbage collection. Note the values listed in the Allocated and # Objects columns.")])]),t._v(" "),s("li",[s("p",[t._v("Here's where you'll exercise your app and watch for memory leaks. For example, if you're using the AppLeak sample app linked to below, click the Test 1 button, click Back, and repeat. Memory and the object count in DDMS will grow, though that number includes objects that are ready to be garbage collected.")])]),t._v(" "),s("li",[s("p",[t._v("Click Cause GC to force garbage collection. If there's a leak, the values of Allocated and # Objects won't return to their former values.")])])]),t._v(" "),s("p",[t._v("These steps don't tell you exactly what is causing the leak in your app. Unlike Instruments, DDMS doesn't clearly show which objects are remaining in memory rather than being collected. You will need to test your app and watch the memory values to infer the potential causes of the leak.")]),t._v(" "),s("p",[s("img",{attrs:{src:a(752),alt:"ddms"}})]),t._v(" "),s("h3",{attrs:{id:"monitoring-allocations-on-windows"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#monitoring-allocations-on-windows"}},[t._v("#")]),t._v(" Monitoring allocations on Windows")]),t._v(" "),s("p",[t._v('Microsoft Visual Studio has "Diagnostic Tools" for monitoring memory usage.')]),t._v(" "),s("ol",[s("li",[s("p",[t._v("Open Visual Studio.")])]),t._v(" "),s("li",[s("p",[t._v("Select "),s("strong",[t._v("Debug")]),t._v(" > "),s("strong",[t._v("Performance Profiler...")]),t._v(" from Visual Studio menu.")])]),t._v(" "),s("li",[s("p",[t._v("Select "),s("strong",[t._v("Choose Target")]),t._v(" drop down list and choose target to profile. For instance choose "),s("strong",[t._v("Installed App...")]),t._v(" for monitoring installed Windows Store app. This tool also supports analyzing target against simulators and remote machine. Please refer to "),s("a",{attrs:{href:"http://msdn.microsoft.com/query/dev14.query?appId=Dev14IDEF1&l=EN-US&k=k(vs.debug.remote.overview)&rd=true",target:"_blank",rel:"noopener noreferrer"}},[t._v("Remote Debugging"),s("OutboundLink")],1),t._v(" for more information.")]),t._v(" "),s("p",[s("img",{attrs:{src:a(753),alt:"win1"}})])]),t._v(" "),s("li",[s("p",[t._v("Choose "),s("strong",[t._v("Memory Usage")]),t._v(" from "),s("strong",[t._v("Available Tools")]),t._v(" section, to investigate application memory to find issues such as memory leaks.")]),t._v(" "),s("p",[s("img",{attrs:{src:a(754),alt:"win3"}})])]),t._v(" "),s("li",[s("p",[t._v("Start monitoring by clicking "),s("strong",[t._v("Start")])])]),t._v(" "),s("li",[s("p",[t._v("When you want to take memory snapshot of the application, push "),s("strong",[t._v("Take snapshot")]),t._v(" button.")]),t._v(" "),s("p",[s("img",{attrs:{src:a(755),alt:"takesnap2"}})])]),t._v(" "),s("li",[s("p",[t._v("Then Visual Studio shows native heap and allocation details when you take snapshot and Visual Studio finishes diagnostics session.")]),t._v(" "),s("p",[s("img",{attrs:{src:a(756),alt:"takesnapdetail"}})])])]),t._v(" "),s("p",[t._v("For more information about Profiling Tools please refer to "),s("a",{attrs:{href:"https://msdn.microsoft.com/en-us/library/mt695328.aspx",target:"_blank",rel:"noopener noreferrer"}},[t._v("Running Profiling Tools With or Without the Debugger"),s("OutboundLink")],1),t._v(".")]),t._v(" "),s("h3",{attrs:{id:"hands-on-practice"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hands-on-practice"}},[t._v("#")]),t._v(" Hands-on practice")]),t._v(" "),s("h4",{attrs:{id:"goal"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#goal"}},[t._v("#")]),t._v(" Goal")]),t._v(" "),s("p",[t._v("You'll examine an app that has a memory leak deliberately included. You'll apply various fixed and check your work until you have eliminated the leak.")]),t._v(" "),s("p",[t._v("(This lab is written to work on iOS / macOS. See the notes at the end of the lab for Android and Windows information.)")]),t._v(" "),s("h4",{attrs:{id:"steps"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#steps"}},[t._v("#")]),t._v(" Steps")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("Download or clone the AppLeak project from "),s("a",{attrs:{href:"https://github.com/appcelerator-developer-relations/appc-sample-app-leak",target:"_blank",rel:"noopener noreferrer"}},[t._v("Github"),s("OutboundLink")],1),t._v(". Extract it and then import the project into Studio or your CLI workspace. Confirm that the tiapp.xml file has appropriate values for your environment then close that file.")])]),t._v(" "),s("li",[s("p",[t._v("Open "),s("code",[t._v("test1.js")]),t._v(" in Studio or your Editor. This file contains the leak, which you will fix.")])]),t._v(" "),s("li",[s("p",[t._v("Build the project for the iPhone or iPad simulator.")])]),t._v(" "),s("li",[s("p",[t._v("Open Instruments and attach it to your app's process:")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("In the Choose a Template window, click Allocations and then click Choose.")])]),t._v(" "),s("li",[s("p",[t._v("Click Choose Target, Attach to Process, then under System, click AppLeak.")])]),t._v(" "),s("li",[s("p",[t._v("Click Record. Wait a moment till data begins recording.")])]),t._v(" "),s("li",[s("p",[t._v("In the Instrument Detail filter box, enter "),s("code",[t._v("TiUITable")]),t._v(".")])])])]),t._v(" "),s("li",[s("p",[t._v("In the simulator, click the Test 1 button. In Instruments, the # Living column for "),s("code",[t._v("TiUITableViewRowProxy")]),t._v(" should show 5 objects are in memory; these objects correspond to the rows in the table. Close the modal window, then click Test 1 again. This time, # Living should increase to 10. The original 5 rows were not released and 5 new rows are allocated in memory. While the actual usage is small, if you were to repeatedly show this window enough times the app would exhaust its available memory and crash.")])]),t._v(" "),s("li",[s("p",[t._v("Close the simulator. That will stop the data recording in Instruments.")])]),t._v(" "),s("li",[s("p",[t._v("In Studio, in "),s("code",[t._v("test1.js")]),t._v(", examine the code and speculate on the cause of the leak.")])]),t._v(" "),s("li",[s("p",[t._v("Add this code after the existing app-level event listener:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("test1win.addEventListener('close', function() {\n  Ti.App.removeEventListener('bad:idea', doSomething);\n});\n")])])])]),t._v(" "),s("li",[s("p",[t._v("Build your app for the simulator again.")])]),t._v(" "),s("li",[s("p",[t._v("Repeat the Instruments testing steps listed above. This time, you should see the numbers in the # Transitory column increase as you open and close the Test 1 window. These values represent objects that have been garbage collected. You might see # Living go up above the 5 active rows occasionally; this simply reflects Instruments reacting more slowly than you clicking through the app. Note that because these objects are managed by garbage collection, you may not see them released immediately.")])]),t._v(" "),s("li",[s("p",[t._v("Close the Simulator and Instruments; don't save the log results.")])])]),t._v(" "),s("p",[t._v("The app-level listener added within "),s("code",[t._v("build()")]),t._v(" remains in scope after the window is closed. This forces the objects the window contains to remain in scope, which means they cannot be garbage collected. When "),s("code",[t._v("build()")]),t._v(" runs again, a new window and table are created, which also cannot be garbage collected. You've got a leak! By removing the event listener when the window closes, the rest of the objects can be marked as ready for garbage collection. Even though a new set of objects are created by "),s("code",[t._v("build()")]),t._v(", the old ones are gone from memory and this leak is fixed.")]),t._v(" "),s("h4",{attrs:{id:"android-notes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#android-notes"}},[t._v("#")]),t._v(" Android notes")]),t._v(" "),s("p",[t._v("Memory leaks can be a problem for Android, even though we didn't highlight that platform in this lab. You can use the DDMS tool, and its Allocation Tracker component to watch for such leaks. We choose to use Instruments in this lab because the output is by far more obvious and the steps to discover a leak are simpler.")]),t._v(" "),s("h2",{attrs:{id:"summary"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#summary"}},[t._v("#")]),t._v(" Summary")]),t._v(" "),s("p",[t._v("In this section, you learned how memory is managed by JavaScript and Titanium. You learned that you must actively manage memory by actively managing the allocation and destruction of Titanium objects. You also learned how to use Instruments to monitor memory usage and potential leaks for iOS development.")]),t._v(" "),s("h3",{attrs:{id:"references"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#references"}},[t._v("#")]),t._v(" References")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("O'Reilly's "),s("a",{attrs:{href:"http://docstore.mik.ua/orelly/webprog/jscript/ch11_03.htm",target:"_blank",rel:"noopener noreferrer"}},[t._v("JavaScript: The Definitive Guide, section 11.3 Garbage Collection"),s("OutboundLink")],1)])]),t._v(" "),s("li",[s("p",[t._v("Video: Your Apps are Leaking, by Rick Blalock at "),s("a",{attrs:{href:"http://vimeopro.com/appcelerator/codestrong-2011/video/29804284",target:"_blank",rel:"noopener noreferrer"}},[t._v("Codestrong 2011"),s("OutboundLink")],1)])]),t._v(" "),s("li",[s("p",[t._v("Titanium Mobile "),s("RouterLink",{attrs:{to:"/guide/Titanium_SDK/Titanium_SDK_Guide/Best_Practices_and_Recommendations/"}},[t._v("Best Practices and Recommendations")])],1)])])])}),[],!1,null,null,null);e.default=n.exports},750:function(t,e,a){t.exports=a.p+"assets/img/Xcode9Workspace.be0b8c99.png"},751:function(t,e,a){t.exports=a.p+"assets/img/instruments.28e142b2.png"},752:function(t,e,a){t.exports=a.p+"assets/img/ddms.e3f98d54.png"},753:function(t,e,a){t.exports=a.p+"assets/img/win1.2f37f6a3.png"},754:function(t,e,a){t.exports=a.p+"assets/img/win3.82c0b538.png"},755:function(t,e,a){t.exports=a.p+"assets/img/takesnap2.093aff55.png"},756:function(t,e,a){t.exports=a.p+"assets/img/takesnapdetail.495afb89.png"}}]);